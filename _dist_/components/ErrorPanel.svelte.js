import"./ErrorPanel.svelte.css.proxy.js";import{HtmlTag as H,SvelteComponent as O,append as b,attr as p,component_subscribe as U,destroy_each as Y,detach as T,element as y,init as $,insert as E,listen as g,noop as L,run_all as z,safe_not_equal as B,set_data as M,space as N,text as P}from"../../_snowpack/pkg/svelte/internal.js";import{onMount as G}from"../../_snowpack/pkg/svelte.js";import J from"../config.js";import{getKey as Q,setKey as R}from"../utils/storage.js";import{_ as V}from"../../_snowpack/pkg/svelte-i18n.js";function A(t,e,s){const r=t.slice();return r[13]=e[s],r}function F(t){let e=t[1]("or it will automatically close later")+"",s;return{c(){s=P(e)},m(r,n){E(r,s,n)},p(r,n){n&2&&e!==(e=r[1]("or it will automatically close later")+"")&&M(s,e)},d(r){r&&T(s)}}}function K(t){let e,s,r=t[13].html+"",n,u,o=t[1]("Click to close")+"",f,h,m,k,w,i=t[13].defaultTime!==-1&&F(t);function S(...a){return t[6](t[13],...a)}function C(...a){return t[7](t[13],...a)}function I(...a){return t[8](t[13],...a)}function l(...a){return t[9](t[13],...a)}function c(...a){return t[10](t[13],...a)}function d(...a){return t[11](t[13],...a)}return{c(){e=y("div"),s=new H(!1),n=N(),u=y("p"),f=P(o),h=N(),i&&i.c(),m=N(),s.a=n,p(u,"id","closeTip"),p(u,"class","svelte-ael0su"),p(e,"class","error svelte-ael0su"),p(e,"tabindex","0")},m(a,_){E(a,e,_),s.m(r,e),b(e,n),b(e,u),b(u,f),b(u,h),i&&i.m(u,null),b(e,m),k||(w=[g(e,"mouseover",S),g(e,"mouseout",C),g(e,"focus",I),g(e,"blur",l),g(e,"click",c),g(e,"keypress",d)],k=!0)},p(a,_){t=a,_&1&&r!==(r=t[13].html+"")&&s.p(r),_&2&&o!==(o=t[1]("Click to close")+"")&&M(f,o),t[13].defaultTime!==-1?i?i.p(t,_):(i=F(t),i.c(),i.m(u,null)):i&&(i.d(1),i=null)},d(a){a&&T(e),i&&i.d(),k=!1,z(w)}}}function W(t){let e,s=t[0],r=[];for(let n=0;n<s.length;n+=1)r[n]=K(A(t,s,n));return{c(){e=y("div");for(let n=0;n<r.length;n+=1)r[n].c();p(e,"id","errors"),p(e,"class","svelte-ael0su")},m(n,u){E(n,e,u);for(let o=0;o<r.length;o+=1)r[o].m(e,null)},p(n,[u]){if(u&31){s=n[0];let o;for(o=0;o<s.length;o+=1){const f=A(n,s,o);r[o]?r[o].p(f,u):(r[o]=K(f),r[o].c(),r[o].m(e,null))}for(;o<r.length;o+=1)r[o].d(1);r.length=s.length}},i:L,o:L,d(n){n&&T(e),Y(r,n)}}}const j=2500;function X(t,e=j,s=""){return{html:t,slug:s===""?s:String(Math.random()),defaultTime:e}}function Z(t,e,s){let r;U(t,V,l=>s(1,r=l));let n=[],u={};function o(l){s(0,n=n.filter(c=>c.slug!==l))}function f(l,c=j){const d=X(l,c);s(0,n=[...n,d]),m(d)}function h(l){l.defaultTime<0||(clearTimeout(u[l.slug]),delete u[l.slug])}function m(l){l.defaultTime<0||(u[l.slug]=setTimeout(()=>{o(l.slug),delete u[l.slug]},l.defaultTime))}return G(()=>{window.errorFormatter=f,fetch(J.notice).then(l=>l.json()).catch(l=>[]).then(l=>{const c=Q("last_notification_date"),d=c?new Date(Number(c)):new Date(0),a=Number(new Date);let _=3;for(const v of l.filter(D=>Number(new Date(D.date))<=a).sort((D,q)=>Number(new Date(q.date))-Number(new Date(D.date)))){if(Number(new Date(v.date))<Number(d)||_===0)break;console.log(Number(new Date(v.date)),Number(d)),f(v.content,v.time||j),_--}R("last_notification_date",String(a))}).catch()}),[n,r,o,h,m,f,(l,c)=>h(l),(l,c)=>m(l),(l,c)=>h(l),(l,c)=>m(l),(l,c)=>o(l.slug),(l,c)=>o(l.slug)]}class x extends O{constructor(e){super();$(this,e,Z,W,B,{displayError:5})}get displayError(){return this.$$.ctx[5]}}export default x;
